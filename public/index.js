(()=>{"use strict";const e="https://api.themoviedb.org/3",t={Authorization:"Bearer eyJhbGciOiJIUzI1NiJ9.eyJhdWQiOiIzODc3Y2NkZjhkNDFiMmMwNDAyYTQ2YjMzYTFmODU1NiIsIm5iZiI6MTc2NjUxODEzOS43OTMsInN1YiI6IjY5NGFlZDdiNTdkNDhkY2VmMWIxZDQzNSIsInNjb3BlcyI6WyJhcGlfcmVhZCJdLCJ2ZXJzaW9uIjoxfQ.s7dVAKaihxDgIwKIEr3xcrCyabNxYLBHKMUNAO1ENEU","Content-Type":"application/json"};class o{static async getTrendingMovies(o=1){return(await fetch(`${e}/trending/movie/day?page=${o}`,{headers:t})).json()}static async searchMovies(o,s=1){return(await fetch(`${e}/search/movie?query=${encodeURIComponent(o)}&page=${s}`,{headers:t})).json()}static async getMovieDetails(o){return(await fetch(`${e}/movie/${o}`,{headers:t})).json()}static async getMovieReviews(o){const s=await fetch(`${e}/movie/${o}/reviews`,{headers:t});return(await s.json()).results||[]}static getImageUrl(e){return e?"https://image.tmdb.org/t/p/w500"+e:"https://via.placeholder.com/500x750?text=No+Image"}}const s="http://localhost:3001/api/auth";class n{static async createRequestToken(){const e=await fetch(`${s}/request-token`,{method:"POST",headers:{"Content-Type":"application/json"}}),t=await e.json();if(t.request_token)return t.request_token;throw new Error("Failed to create request token")}static redirectToTMDBAuth(e){const t=`${window.location.origin}${window.location.pathname}`;window.location.href=`https://www.themoviedb.org/authenticate/${e}?redirect_to=${encodeURIComponent(t)}`}static async createSession(e){const t=await fetch(`${s}/session`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({request_token:e})}),o=await t.json();if(o.sessionId){const e=o.sessionId;return localStorage.setItem(this.STORAGE_KEY,e),localStorage.setItem(this.USER_KEY,JSON.stringify(o.user)),e}throw new Error("Failed to create session")}static isAuthenticated(){return!!localStorage.getItem(this.STORAGE_KEY)}static getSessionId(){return localStorage.getItem(this.STORAGE_KEY)}static getUser(){const e=localStorage.getItem(this.USER_KEY);return e?JSON.parse(e):null}static logout(){localStorage.removeItem(this.STORAGE_KEY),localStorage.removeItem(this.USER_KEY)}static async addReview(e,t,o){const s=this.getSessionId();return!!s&&(await fetch(`http://localhost:3001/api/movie/${e}/rating`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({sessionId:s,rating:t})})).ok}}n.STORAGE_KEY="tmdb_session",n.USER_KEY="tmdb_user";class i{static async getGeolocation(){if(this.cache)return this.cache;try{const e=await fetch("http://localhost:3001/api/proxy/geolocation");if(!e.ok)throw new Error("Failed to fetch geolocation");const t=await e.json();return this.cache=t,t}catch(e){return console.warn("Geolocation fetch failed:",e),null}}}i.cache=null,new class{constructor(){this.currentPage=1,this.movies=[],this.initializeAuth(),this.loadTrendingMovies(),this.loadGeolocation(),this.setupEventListeners()}async loadGeolocation(){const e=await i.getGeolocation();e&&(window.appGeolocation=e)}initializeAuth(){const e=document.getElementById("loginBtn"),t=document.getElementById("logoutBtn");document.getElementById("userInfo"),n.isAuthenticated()&&this.updateAuthUI(),e.addEventListener("click",()=>this.handleLogin()),t?.addEventListener("click",()=>this.handleLogout());const o=new URLSearchParams(window.location.search).get("request_token");o&&n.createSession(o).then(()=>{localStorage.setItem("auth_message","success"),window.location.href="index.html"}).catch(e=>{console.error("Failed to create session from redirect:",e),localStorage.setItem("auth_message","error"),window.location.href="index.html"});const s=localStorage.getItem("auth_message");s&&("success"===s?this.showSuccess("Connexion réussie."):this.showError("Échec de la connexion."),localStorage.removeItem("auth_message"))}showSuccess(e){const t=document.getElementById("success");t.textContent=e,t.style.display="block",setTimeout(()=>{t.style.display="none"},5e3)}async handleLogin(){try{const e=await n.createRequestToken();n.redirectToTMDBAuth(e)}catch(e){console.error("Login error:",e),this.showError("Erreur lors de la connexion")}}handleLogout(){n.logout(),this.currentPage=1,this.movies=[],window.location.href="index.html"}updateAuthUI(){const e=document.getElementById("loginBtn"),t=document.getElementById("userInfo"),o=n.getUser();o&&(e.style.display="none",t.style.display="flex",document.getElementById("username").textContent=o.username,o.avatar&&(document.getElementById("userAvatar").src=o.avatar))}setupEventListeners(){document.getElementById("loadMoreBtn").addEventListener("click",()=>this.loadMoreMovies()),window.addEventListener("scroll",()=>this.handleInfiniteScroll())}handleInfiniteScroll(){window.innerHeight+window.scrollY>=document.documentElement.scrollHeight-500&&"none"!==document.getElementById("loadMoreBtn").style.display&&this.loadMoreMovies()}async loadTrendingMovies(){try{this.showLoading(!0);const e=await o.getTrendingMovies(this.currentPage);this.movies=e.results,this.renderMovies()}catch(e){console.error("Error loading trending movies:",e),this.showError("Erreur lors du chargement des films en tendance")}finally{this.showLoading(!1)}}async loadMoreMovies(){try{this.showLoading(!0),this.currentPage++;const e=await o.getTrendingMovies(this.currentPage);this.movies=[...this.movies,...e.results],this.renderMovies()}catch(e){console.error("Error loading more movies:",e),this.showError("Erreur lors du chargement de plus de films")}finally{this.showLoading(!1)}}renderMovies(){document.getElementById("moviesContainer").innerHTML=this.movies.map(e=>`\n      <div class="movie-card">\n        <img src="${o.getImageUrl(e.poster_path)}" alt="${e.title}" class="movie-poster">\n        <div class="movie-info">\n          <div class="movie-title">${e.title}</div>\n          <div class="movie-date">${new Date(e.release_date).toLocaleDateString("fr-FR")}</div>\n          <button class="more-info-btn" onclick="window.location.href='movie.html?id=${e.id}'">\n            En savoir plus\n          </button>\n        </div>\n      </div>\n    `).join("")}showLoading(e){document.getElementById("loading").classList.toggle("active",e)}showError(e){const t=document.getElementById("error");t.textContent=e,t.style.display="block",setTimeout(()=>{t.style.display="none"},5e3)}}})();
//# sourceMappingURL=index.js.map